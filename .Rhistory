library(rvest)
library(stringr)
url <- "http://catalog.registrar.ucla.edu/ucla-catalog19-20-961.html"
page <- read_html(url)
rank_data_html <- html_text(html_nodes(page,'p, h2'))
prep_marker <- str_which(rank_data_html, "Preparation for the Major")
prep_par <- rank_data_html[prep_marker + 1]
prep_reqs <- str_split_fixed(prep_par, "\\.", 2)[1]
# remove "Required: "
prep_reqs
prep_reqs <- str_replace(prep_reqs, "Required: ", "")
prep_reqs_list <- str_split(prep_reqs, ", ")
# one-step approach
full_reqs <- url %>%
read_html %>%                          # read as html
html_nodes('p, h2') %>%                # query the paragraph under h2 headings
html_text %>%                          # convert to text
subset(str_detect(., "Required")) %>%  # query required courses
str_replace("Required: ", "") %>%      # remove "Required: " from text
str_split_fixed("\\.", 2) %>%          # split on period
subset(select = c(T, F)) %>%           # keep only sentences with courses
str_split(", ")                        # get individual course numbers
# set up OR logic
prep_reqs_list
full_reqs
# playing around
full_reqs[[1]]
# playing around
prereqs <- full_reqs[[1]]
?starts_with
library(dplyr)
?starts_with
str_detect("yes", "[:alpha:]")
str_detect("yes", "[:alpha:]{2,")
str_detect("yes", "[:alpha:]{2,}")
str_detect("y150", "[:alpha:]{2,}")
str_extract("y150", "[:alpha:]{2,}")
str_extract("yes", "[:alpha:]{2,}")
str_extract("yes 150", "[:alpha:]{2,}")
for(i in 1:5) print(i)
?cat
# playing around
prereqs <- full_reqs[[1]]
prereqs
# playing around
prereqs <- full_reqs[[1]][1:8]
for (i in 1:prereqs) {
if (str_detect(prereqs[i], "[:alpha:]{2,}")) {  # extract name if it exists
subject <- str_extract(prereqs[i], "[:alpha:]{2,}")
} else {
prereqs[i] <- paste(subject, prereqs[i])
}
}
for (i in 1:length(prereqs)) {
if (str_detect(prereqs[i], "[:alpha:]{2,}")) {  # extract name if it exists
subject <- str_extract(prereqs[i], "[:alpha:]{2,}")
} else {
prereqs[i] <- paste(subject, prereqs[i])
}
}
prereqs
prereqs <- full_reqs[[1]]
for (i in 1:length(prereqs)) {
if (str_detect(prereqs[i], "[:alpha:]{2,}")) {  # extract name if it exists
subject <- str_extract(prereqs[i], "[:alpha:]{2,}")
} else {
prereqs[i] <- paste(subject, prereqs[i])
}
}
prereqs
prereqs <- full_reqs
for (i in 1:length(prereqs)) {
# extract subject if it exists; otherwise use previous subject
if (str_detect(prereqs[i], "[:alpha:]{2,}")) {
subject <- str_extract(prereqs[i], "[:alpha:]{2,}")
} else {
prereqs[i] <- paste(subject, prereqs[i])
}
}
prereqs
# playing around
prereqs <- full_reqs
?sapply
prepend <- function(req_vec){
for (i in 1:length(req_vec)) {
# extract subject if it exists; otherwise use previous subject
if (str_detect(req_vec[i], "[:alpha:]{2,}")) {
subject <- str_extract(req_vec[i], "[:alpha:]{2,}")
} else {
req_vec[i] <- paste(subject, req_vec[i])
}
}
return(req_vec)
}
lapply(prereqs, prepend)
prepend_reqs <- lapply(full_reqs, prepend)
prepend_reqs
full_reqs
lapply(c(1, 2, 3), sum)
prepend_reqs <- lapply(full_reqs, prepend)
prepend_vecs
prepend_reqs
# extract full list of courses from course requisites list
# maybe there's a better way to do this?
library(readxl)
library(dplyr)
requisites <- read_xlsx("curricular_complexity_data_codebook.xlsx", sheet = 1)
course_list <- requisites %>%
mutate(crs_catlg_no = str_replace(crs_catlg_no, "^0+", ""),
rqs_crs_catlg_no = str_replace(crs_catlg_no, "^0+", "")) %>%
transmute(crs = paste(subj_area_cd, crs_catlg_no),
rqs = paste(rqs_subj_area_cd, rqs_crs_catlg_no)) %>%
unlist(use.names = FALSE)
# extract full list of courses from course requisites list
# maybe there's a better way to do this?
library(readxl)
library(dplyr)
library(stringr)
requisites <- read_xlsx("curricular_complexity_data_codebook.xlsx", sheet = 1)
course_list <- requisites %>%
mutate(crs_catlg_no = str_replace(crs_catlg_no, "^0+", ""),
rqs_crs_catlg_no = str_replace(crs_catlg_no, "^0+", "")) %>%
transmute(crs = paste(subj_area_cd, crs_catlg_no),
rqs = paste(rqs_subj_area_cd, rqs_crs_catlg_no)) %>%
unlist(use.names = FALSE)
course_list
course_list <- requisites %>%
mutate(crs_catlg_no = str_replace(crs_catlg_no, "^0+", ""),
rqs_crs_catlg_no = str_replace(crs_catlg_no, "^0+", "")) %>%
transmute(crs = paste(subj_area_cd, crs_catlg_no),
rqs = paste(rqs_subj_area_cd, rqs_crs_catlg_no)) %>%
unlist(use.names = FALSE) %>%
unique()
course_list
rm(list=ls())
library(rvest)
library(stringr)
url <- "https://www.registrar.ucla.edu/Faculty-Staff/Courses-and-Programs/Major-and-Minor-Codes/Undergraduate-Majors-and-Premajors"
test <- url %>%
read_html %>%                          # read as html
html_nodes('p, h2') %>%                # query the paragraph under h2 headings
html_text
test
test <- url %>%
read_html %>%                          # read as html
html_nodes('td') %>%                # query the paragraph under h2 headings
html_text
test
test <- url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(1)') %>%                # query the paragraph under h2 headings
html_text
test
test <- url %>%
read_html %>%                          # read as html
html_nodes('tr:nth-child(1)') %>%                # query the paragraph under h2 headings
html_text
test
test <- url %>%
read_html %>%                          # read as html
html_nodes('tr') %>%                # query the paragraph under h2 headings
html_text
test
url %>%
read_html %>%                          # read as html
html_nodes('td') %>%                # query the paragraph under h2 headings
html_text
url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(1)') %>%                # query the paragraph under h2 headings
html_text
url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(2)') %>%                # query the paragraph under h2 headings
html_text
test <- url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(1)', 'td:nth-child(2)') %>%                # query the paragraph under h2 headings
html_text
url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child') %>%                # query the paragraph under h2 headings
html_text
url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(1)') %>%                # query the paragraph under h2 headings
html_text
url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(1)', 'td') %>%                # query the paragraph under h2 headings
html_text
url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(1)') %>%                # query the paragraph under h2 headings
html_text %>%
cbind(
url %>%
read_html %>%
html_nodes('td:nth-child(2)') %>%
html_text
)
library(readxl)
library(dplyr)
library(stringr)
requisites <- read_xlsx("curricular_complexity_data_codebook.xlsx", sheet = 1)
course_list <- requisites %>%
mutate(crs_catlg_no = str_replace(crs_catlg_no, "^0+", ""),
rqs_crs_catlg_no = str_replace(crs_catlg_no, "^0+", "")) %>%
transmute(crs = paste(subj_area_cd, crs_catlg_no),
rqs = paste(rqs_subj_area_cd, rqs_crs_catlg_no)) %>%
unlist(use.names = FALSE) %>%
unique()
requisites
course_list
url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(3)') %>%                # query the paragraph under h2 headings
html_text %>%
cbind(
url %>%
read_html %>%
html_nodes('td:nth-child(4)') %>%
html_text
)
url
url <- "https://www.registrar.ucla.edu/Faculty-Staff/Courses-and-Programs/Department-and-Subject-Area-Codes"
url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(3)') %>%                # query the paragraph under h2 headings
html_text %>%
cbind(
url %>%
read_html %>%
html_nodes('td:nth-child(4)') %>%
html_text
)
url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(3)') %>%      # query the paragraph under h2 headings
html_text %>%
cbind(code =
url %>%
read_html %>%
html_nodes('td:nth-child(4)') %>%
html_text)
url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(3)') %>%      # query the paragraph under h2 headings
html_text %>%
cbind(thing = .,code =
url %>%
read_html %>%
html_nodes('td:nth-child(4)') %>%
html_text)
course_list
code_table
code_table <- url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(3)') %>%      # query the paragraph under h2 headings
html_text %>%
cbind(subject = .,
code =
url %>%
read_html %>%
html_nodes('td:nth-child(4)') %>%
html_text)
code_table
course_list
library(rvest)
library(stringr)
# URL for math major
url <- "http://catalog.registrar.ucla.edu/ucla-catalog19-20-961.html"
# page <- read_html(url)
# rank_data_html <- html_text(html_nodes(page,'p, h2'))
#
# prep_marker <- str_which(rank_data_html, "Preparation for the Major")
# prep_par <- rank_data_html[prep_marker + 1]
#
# prep_reqs <- str_split_fixed(prep_par, "\\.", 2)[1]
#
# # remove "Required: "
# prep_reqs <- str_replace(prep_reqs, "Required: ", "")
#
# prep_reqs_list <- str_split(prep_reqs, ", ")
# one-step approach
full_reqs <- url %>%
read_html %>%                          # read as html
html_nodes('p, h2') %>%                # query the paragraph under h2 headings
html_text %>%                          # convert to text
subset(str_detect(., "Required")) %>%  # query required courses
str_replace("Required: ", "") %>%      # remove "Required: " from text
str_split_fixed("\\.", 2) %>%          # split on period
subset(select = c(T, F)) %>%           # keep only sentences with courses
str_split(", ")                        # get individual course numbers
# "prepend" subject field to course number to get full course name
prepend <- function(req_vec){
for (i in 1:length(req_vec)) {
# extract subject if it exists; otherwise use previous subject
if (str_detect(req_vec[i], "[:alpha:]{2,}")) {
subject <- str_extract(req_vec[i], "[:alpha:]{2,}")
} else {
req_vec[i] <- paste(subject, req_vec[i])
}
}
return(req_vec)
}
prepend_reqs <- lapply(full_reqs, prepend)
prepend_reqs
?str_sub
?str_replace
prepend_reqs %>%
str_replace_all(pattern = code_table[,1], replacement = code_table[,2])
prepend_reqs
prepend_reqs[[1]] %>%
str_replace_all(pattern = code_table[,1], replacement = code_table[,2])
code_table[,1]
prepend_reqs[[1]] %>%
str_replace_all(c(pattern1 = replacement1))
prepend_reqs[[1]] %>%
str_replace_all(c(pattern1 = code_table[,2]))
str_extract(prepend_reqs[[1]], "Mathematics")
code_table[,2]
code_table[,1]
prepend_reqs[[1]] %>%
str_replace_all(c(pattern1 = code_table[,1]))
code_table[,2]
code_table <- url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(3)') %>%      # query the paragraph under h2 headings
html_text %>%
cbind(subject = .,
code =
url %>%
read_html %>%
html_nodes('td:nth-child(4)') %>%
html_text %>%
str_trim)
code_table
code_table <- url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(3)') %>%      # query the paragraph under h2 headings
html_text %>%
cbind(subject = .,
code =
url %>%
read_html %>%
html_nodes('td:nth-child(4)') %>%
html_text %>%
str_trim)
code_table
code_table <- url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(3)') %>%      # query the paragraph under h2 headings
html_text %>%
cbind(subject = .,
code =
url %>%
read_html %>%
html_nodes('td:nth-child(4)') %>%
html_text %>%
str_trim(side = "both"))
code_table
library(stringr)
url <- "https://www.registrar.ucla.edu/Faculty-Staff/Courses-and-Programs/Department-and-Subject-Area-Codes"
code_table <- url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(3)') %>%      # query the paragraph under h2 headings
html_text %>%
cbind(subject = .,
code =
url %>%
read_html %>%
html_nodes('td:nth-child(4)') %>%
html_text %>%
str_trim(side = "both"))
code_table
prepend_reqs[[1]] %>%
str_replace_all(c(pattern1 = code_table[,1]))
prepend_reqs[[1]] %>%
str_replace_all(c(pattern1 = code_table[,2]))
prepend_reqs[[1]] %>%
str_replace_all(c(code_table[,1] = code_table[,2]))
prepend_reqs[[1]] %>%
str_replace_all(c("Mathematics" = "Math", "Physics" = "Phys"))
?c
?setNames
setNames(code_table["subject"], code_table["code"])
code_table["subject"]
code_table
code_table[, "subject"]
url <- "https://www.registrar.ucla.edu/Faculty-Staff/Courses-and-Programs/Department-and-Subject-Area-Codes"
code_table <- url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(3)') %>%      # query the paragraph under h2 headings
html_text %>%
cbind(subject = .,
code =
url %>%
read_html %>%
html_nodes('td:nth-child(4)') %>%
html_text %>%
str_trim(side = "both")) %>%
as_tibble()
code_table
prepend_reqs[[1]] %>%
str_replace_all(setNames(code_table$subject, code_table$code))
setNames(code_table$subject, code_table$code)
prepend_reqs[[1]] %>%
str_replace_all(setNames(code_table$code, code_table$subject))
prepend_reqs[[1]] %>%
str_replace_all(setNames(code_table$code, code_table$subject))
library(readxl)
library(dplyr)
library(stringr)
requisites <- read_xlsx("curricular_complexity_data_codebook.xlsx", sheet = 1)
course_list <- requisites %>%
mutate(crs_catlg_no = str_replace(crs_catlg_no, "^0+", ""),
rqs_crs_catlg_no = str_replace(crs_catlg_no, "^0+", "")) %>%
transmute(crs = paste(subj_area_cd, crs_catlg_no),
rqs = paste(rqs_subj_area_cd, rqs_crs_catlg_no)) %>%
unlist(use.names = FALSE) %>%
unique()
course_list
requisites
url <- "https://www.registrar.ucla.edu/Faculty-Staff/Courses-and-Programs/Department-and-Subject-Area-Codes"
code_table <- url %>%
read_html %>%                          # read as html
html_nodes('td:nth-child(3)') %>%      # query the paragraph under h2 headings
html_text %>%
cbind(subject = .,
code =
url %>%
read_html %>%
html_nodes('td:nth-child(4)') %>%
html_text %>%
str_trim(side = "both")) %>%
as_tibble()
code_table
